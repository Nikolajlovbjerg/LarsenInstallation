@using Core
@inject HttpClient http
@inject NavigationManager navMan

<div class="row">
    @if (projectlist != null && projectlist.Count > 0)
    {
        @foreach (var project in projectlist)
        {
            <div class="col-12 mb-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5>@project.ProjectId - @project.Name</h5>
                        <p>Oprettet: @project.DateCreated.ToString("dd/MM/yyyy")</p>

                        @if (project.Calculations != null && project.Calculations.Count > 0)
                        {
                            <ul>
                                @foreach (var calc in project.Calculations)
                                {
                                    <li>@calc.Type: @calc.TotalHours timer</li>
                                }
                            </ul>
                        }
                        else
                        {
                            <p>Ingen timer registreret for dette projekt.</p>
                        }

                        <button class="btn btn-outline-primary" @onclick="NavigateToProjectDetails">
                            Se mere
                        </button>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <p>Indlæser projekter...</p>
    }
</div>

@code {
    private List<Project> projectlist;
    private List<Calculation> calculations;

    protected override async Task OnInitializedAsync()
    {
        // Hent projekter fra API
        projectlist = await http.GetFromJsonAsync<List<Project>>("http://localhost:5028/api/projectlist");

        // Hent beregninger fra API
        calculations = await http.GetFromJsonAsync<List<Calculation>>("http://localhost:5028/api/projecthours");

        // Gruppér beregninger pr. projekt uden arrow-funktion og method chaining
        if (projectlist != null && calculations != null)
        {
            foreach (var project in projectlist)
            {
                project.Calculations = new List<Calculation>();

                foreach (var calc in calculations)
                {
                    if (calc.ProjectId == project.ProjectId)
                    {
                        project.Calculations.Add(calc);
                    }
                }
            }
        }
    }

    private void NavigateToProjectDetails()
    {
        // Her kan du implementere navigation til projektdetaljeside
        // fx navMan.NavigateTo("/projects/" + projectId);
    }
}
